---
title: "EDA of Endometrial Cancer Incidence in Sweden 1970-2024"
author: "Carmen Canedo"
output:
  pdf_document: default
  html_notebook: default
---

```{r setup, include=FALSE, eval=TRUE}
knitr::opts_chunk$set(eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE)
```


```{r, include=FALSE}
library(tidyverse)
```

```{r}
ec <- read_delim("data/Statistikdatabasen_2026-01-29 10_27_59.csv",
               # File automatically comes with header. Could be worth deleting manually later
               skip = 1,
               delim = ";") 
  
```

```{r}
# Cleaning
ec <- ec %>% 
  rename(year = År,
         region = Region,
         age_0_17 = 3,
         age_18_29 = 4,
         age_30_44 = 5,
         age_45_64 = 6,
         age_65_79 = 7,
         age_80_plus = 8,
         age_all = Totalt)
```


```{r}
ec_long <- ec %>% 
  pivot_longer(cols = starts_with("age_"),
               names_to = "age",
               values_to = "incidence")
```


# Selection Overview
The `ec` table is pulled from [Socialstyrelsen Statistikdatabas för cancer](https://sdb.socialstyrelsen.se/if_can/val.aspx) with the following selections:

  + International incidence definition of morbidity IARC/IACR/ENCR
  + Tumor diagnosis (ICD-7): 172 Livmoderkropp (corpus uteri)
    - Note: ICD-10 is C54
  + Regardless of tumor type(s)
  + All regions, including Riket
  + Older age groups (with ages shown separately):
    - 0-17
    - 18-29
    - 30-44
    - 45-64
    - 65-79
    - 80+
  + Sex: women
  + Years: 1970-2024
  
# Summary Statistics
## Descriptive stats for all regions over all years
```{r}
summary_reg_yrs <- ec_long %>% 
  summarise(Minimum = min(incidence),
         Mean = mean(incidence),
         Median = median(incidence),
         "Std. Deviation" = sd(incidence, na.rm = TRUE),
         Variance = var(incidence, na.rm = TRUE),
         Max = max(incidence),
         .by = c(year, region)) %>% 
  arrange(region)
```


## Descriptive stats for all ages regardless of region
```{r}
summary_age_yrs <- ec_long %>% 
  summarise(Minimum = min(incidence),
         Mean = mean(incidence),
         Median = median(incidence),
         "Std. Deviation" = sd(incidence, na.rm = TRUE),
         Variance = var(incidence, na.rm = TRUE),
         Max = max(incidence),
         .by = c(year, age)) %>% 
  arrange(age)
```


# Boxplots
```{r}
ec_long %>% 
  filter(region != "Riket",
         age == "age_all") %>% 
  ggplot(aes(region, incidence)) +
  geom_boxplot() +
  coord_flip() +
  theme_minimal() +
  labs(title = "Endometrial Cancer Incidence in Sweden from 1970-2024
by Region",
       x = "Region", y = "Incidence")
```

```{r}
large_regions <- c("Stockholms län", "Västra Götalands län", "Skåne län")
```

```{r}
ec_long %>% 
  filter(region != "Riket",
         age == "age_all") %>%
  filter(!(region %in% large_regions)) %>% 
  ggplot(aes(region, incidence)) +
  geom_boxplot() +
  coord_flip() +
  theme_minimal() +
  labs(title = "Endometrial Cancer Incidence in Sweden from 1970-2024
by Region (except Stockholms Län, Västra Götalands Län, Skåne Län)",
       x = "Region", y = "Incidence")
```
```{r}
ec_long %>% 
  filter(region != "Riket",
         age == "age_all") %>%
  filter((region %in% large_regions)) %>% 
  ggplot(aes(region, incidence)) +
  geom_boxplot() +
  coord_flip() +
  theme_minimal()  +
  labs(title = "Endometrial Cancer Incidence in Sweden from 1970-2024 in
Stockholms Län, Västra Götalands Län, Skåne Län Regions",
       x = "Region", y = "Incidence")
```


```{r}
ec_long %>% 
  filter(region == "Riket",
         age != "age_all") %>% 
  ggplot(aes(age, incidence)) +
  geom_boxplot() +
  coord_flip() +
  theme_minimal() +
  labs(title = "Endometrial Cancer Incidence in Sweden from 1970-2024 by Age Group",
       x = "Region", y = "Incidence")
```
```{r}
younger_groups <- c("age_0_17", "age_18_29", "age_30_44")

ec_long %>% 
  filter(region == "Riket",
         age %in% younger_groups) %>% 
  ggplot(aes(age, incidence)) +
  geom_boxplot() +
  coord_flip() +
  theme_minimal() +
  labs(title = "Endometrial Cancer Incidence in Sweden from 1970-2024
by Age Groups 0-17, 18-29, 30-44",
       x = "Region", y = "Incidence")
```


# Incidence over time

```{r}
ec_long %>% 
  filter(region == "Riket",
         age == "age_all") %>% 
  filter(!(region %in% large_regions)) %>% 
  ggplot(aes(year, incidence)) +
  geom_line()  +
  theme_light() +
  labs(title = "Endometrial Cancer Incidence in Sweden across All Regions and Ages
from 1970-2024",
       x = "Year", y = "Incidence")
```
```{r}
ec_long %>% 
  filter(region %in% large_regions,
         age == "age_all") %>% 
  ggplot(aes(year, incidence, color = region)) +
  geom_line()   +
  theme_light() +
  labs(title = "Endometrial Cancer Incidence in Sweden in Skåne Län, Stockholms Län, 
Västra Götalands Län, and All Ages from 1970-2024",
       x = "Year", y = "Incidence")
```


```{r}
ec_long %>% 
  filter(region != "Riket",
         age == "age_all") %>% 
  filter(!(region %in% large_regions)) %>% 
  ggplot(aes(year, incidence)) +
  geom_line() +
  facet_wrap(vars(region))    +
  theme_light() +
  labs(title = "Endometrial Cancer Incidence in Sweden (except Skåne Län, Stockholms Län, 
Västra Götalands Län), and All Ages from 1970-2024",
       x = "Year", y = "Incidence")
```

How can you group the counties together other than alphabetically as done here?
Is there a way to show counties that border each other and do some sort of cluster analysis?

```{r}
ec_long %>% 
  filter(region == "Riket",
         !(age %in% younger_groups)) %>% 
  ggplot(aes(year, incidence)) +
  geom_line() +
  facet_wrap(vars(age)) +
  theme_light() +
  labs(title = "Endometrial Cancer Incidence in Sweden by Age Group from 1970-2024",
       x = "Year", y = "Incidence")
```

```{r}
ec_long %>% 
  filter(region == "Riket",
         (age %in% younger_groups)) %>% 
  ggplot(aes(year, incidence)) +
  geom_line() +
  facet_wrap(vars(age)) +
  theme_light() +
  labs(title = "Endometrial Cancer Incidence among Ages 0-44 in Sweden
by Age Group from 1970-2024",
       x = "Year", y = "Incidence")
```

```{r}
ec_long %>% 
  filter(region == "Riket",
         age == "age_30_44") %>% 
  ggplot(aes(x = year, y = incidence)) +
  geom_point() +
  geom_smooth() +
  theme_light() +
  labs(title = "Endometrial Cancer Incidence among Ages 30-44 in Sweden
by Age Group from 1970-2024",
       x = "Year", y = "Incidence")
```
Interesting that there was a decline until early 2000s and now there's an increase.
Is it significant?
